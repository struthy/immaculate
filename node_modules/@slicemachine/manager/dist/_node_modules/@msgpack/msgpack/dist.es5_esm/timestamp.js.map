{"version":3,"file":"timestamp.js","sources":["../../../../../../../node_modules/@msgpack/msgpack/dist.es5+esm/timestamp.mjs"],"sourcesContent":["// https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type\nimport { DecodeError } from \"./DecodeError.mjs\";\nimport { getInt64, setInt64 } from \"./utils/int.mjs\";\nexport var EXT_TIMESTAMP = -1;\nvar TIMESTAMP32_MAX_SEC = 0x100000000 - 1; // 32-bit unsigned int\nvar TIMESTAMP64_MAX_SEC = 0x400000000 - 1; // 34-bit unsigned int\nexport function encodeTimeSpecToTimestamp(_a) {\n    var sec = _a.sec, nsec = _a.nsec;\n    if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {\n        // Here sec >= 0 && nsec >= 0\n        if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {\n            // timestamp 32 = { sec32 (unsigned) }\n            var rv = new Uint8Array(4);\n            var view = new DataView(rv.buffer);\n            view.setUint32(0, sec);\n            return rv;\n        }\n        else {\n            // timestamp 64 = { nsec30 (unsigned), sec34 (unsigned) }\n            var secHigh = sec / 0x100000000;\n            var secLow = sec & 0xffffffff;\n            var rv = new Uint8Array(8);\n            var view = new DataView(rv.buffer);\n            // nsec30 | secHigh2\n            view.setUint32(0, (nsec << 2) | (secHigh & 0x3));\n            // secLow32\n            view.setUint32(4, secLow);\n            return rv;\n        }\n    }\n    else {\n        // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n        var rv = new Uint8Array(12);\n        var view = new DataView(rv.buffer);\n        view.setUint32(0, nsec);\n        setInt64(view, 4, sec);\n        return rv;\n    }\n}\nexport function encodeDateToTimeSpec(date) {\n    var msec = date.getTime();\n    var sec = Math.floor(msec / 1e3);\n    var nsec = (msec - sec * 1e3) * 1e6;\n    // Normalizes { sec, nsec } to ensure nsec is unsigned.\n    var nsecInSec = Math.floor(nsec / 1e9);\n    return {\n        sec: sec + nsecInSec,\n        nsec: nsec - nsecInSec * 1e9,\n    };\n}\nexport function encodeTimestampExtension(object) {\n    if (object instanceof Date) {\n        var timeSpec = encodeDateToTimeSpec(object);\n        return encodeTimeSpecToTimestamp(timeSpec);\n    }\n    else {\n        return null;\n    }\n}\nexport function decodeTimestampToTimeSpec(data) {\n    var view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n    // data may be 32, 64, or 96 bits\n    switch (data.byteLength) {\n        case 4: {\n            // timestamp 32 = { sec32 }\n            var sec = view.getUint32(0);\n            var nsec = 0;\n            return { sec: sec, nsec: nsec };\n        }\n        case 8: {\n            // timestamp 64 = { nsec30, sec34 }\n            var nsec30AndSecHigh2 = view.getUint32(0);\n            var secLow32 = view.getUint32(4);\n            var sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;\n            var nsec = nsec30AndSecHigh2 >>> 2;\n            return { sec: sec, nsec: nsec };\n        }\n        case 12: {\n            // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n            var sec = getInt64(view, 4);\n            var nsec = view.getUint32(0);\n            return { sec: sec, nsec: nsec };\n        }\n        default:\n            throw new DecodeError(\"Unrecognized data size for timestamp (expected 4, 8, or 12): \".concat(data.length));\n    }\n}\nexport function decodeTimestampExtension(data) {\n    var timeSpec = decodeTimestampToTimeSpec(data);\n    return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);\n}\nexport var timestampExtension = {\n    type: EXT_TIMESTAMP,\n    encode: encodeTimestampExtension,\n    decode: decodeTimestampExtension,\n};\n//# sourceMappingURL=timestamp.mjs.map"],"names":[],"mappings":";;AAGU,IAAC,gBAAgB;AAC3B,IAAI,sBAAsB,aAAc;AACxC,IAAI,sBAAsB,cAAc;AACjC,SAAS,0BAA0B,IAAI;AAC1C,MAAI,MAAM,GAAG,KAAK,OAAO,GAAG;AAC5B,MAAI,OAAO,KAAK,QAAQ,KAAK,OAAO,qBAAqB;AAErD,QAAI,SAAS,KAAK,OAAO,qBAAqB;AAE1C,UAAI,KAAK,IAAI,WAAW,CAAC;AACzB,UAAI,OAAO,IAAI,SAAS,GAAG,MAAM;AACjC,WAAK,UAAU,GAAG,GAAG;AACrB,aAAO;AAAA,IACV,OACI;AAED,UAAI,UAAU,MAAM;AACpB,UAAI,SAAS,MAAM;AACnB,UAAI,KAAK,IAAI,WAAW,CAAC;AACzB,UAAI,OAAO,IAAI,SAAS,GAAG,MAAM;AAEjC,WAAK,UAAU,GAAI,QAAQ,IAAM,UAAU,CAAI;AAE/C,WAAK,UAAU,GAAG,MAAM;AACxB,aAAO;AAAA,IACV;AAAA,EACJ,OACI;AAED,QAAI,KAAK,IAAI,WAAW,EAAE;AAC1B,QAAI,OAAO,IAAI,SAAS,GAAG,MAAM;AACjC,SAAK,UAAU,GAAG,IAAI;AACtB,aAAS,MAAM,GAAG,GAAG;AACrB,WAAO;AAAA,EACV;AACL;AACO,SAAS,qBAAqB,MAAM;AACvC,MAAI,OAAO,KAAK;AAChB,MAAI,MAAM,KAAK,MAAM,OAAO,GAAG;AAC/B,MAAI,QAAQ,OAAO,MAAM,OAAO;AAEhC,MAAI,YAAY,KAAK,MAAM,OAAO,GAAG;AACrC,SAAO;AAAA,IACH,KAAK,MAAM;AAAA,IACX,MAAM,OAAO,YAAY;AAAA,EACjC;AACA;AACO,SAAS,yBAAyB,QAAQ;AAC7C,MAAI,kBAAkB,MAAM;AACxB,QAAI,WAAW,qBAAqB,MAAM;AAC1C,WAAO,0BAA0B,QAAQ;AAAA,EAC5C,OACI;AACD,WAAO;AAAA,EACV;AACL;AACO,SAAS,0BAA0B,MAAM;AAC5C,MAAI,OAAO,IAAI,SAAS,KAAK,QAAQ,KAAK,YAAY,KAAK,UAAU;AAErE,UAAQ,KAAK,YAAU;AAAA,IACnB,KAAK,GAAG;AAEJ,UAAI,MAAM,KAAK,UAAU,CAAC;AAC1B,UAAI,OAAO;AACX,aAAO,EAAE,KAAU,KAAU;AAAA,IAChC;AAAA,IACD,KAAK,GAAG;AAEJ,UAAI,oBAAoB,KAAK,UAAU,CAAC;AACxC,UAAI,WAAW,KAAK,UAAU,CAAC;AAC/B,UAAI,OAAO,oBAAoB,KAAO,aAAc;AACpD,UAAI,OAAO,sBAAsB;AACjC,aAAO,EAAE,KAAU,KAAU;AAAA,IAChC;AAAA,IACD,KAAK,IAAI;AAEL,UAAI,MAAM,SAAS,MAAM,CAAC;AAC1B,UAAI,OAAO,KAAK,UAAU,CAAC;AAC3B,aAAO,EAAE,KAAU,KAAU;AAAA,IAChC;AAAA,IACD;AACI,YAAM,IAAI,YAAY,gEAAgE,OAAO,KAAK,MAAM,CAAC;AAAA,EAChH;AACL;AACO,SAAS,yBAAyB,MAAM;AAC3C,MAAI,WAAW,0BAA0B,IAAI;AAC7C,SAAO,IAAI,KAAK,SAAS,MAAM,MAAM,SAAS,OAAO,GAAG;AAC5D;AACU,IAAC,qBAAqB;AAAA,EAC5B,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,QAAQ;AACZ;","x_google_ignoreList":[0]}