{"version":3,"file":"node-client.cjs","sources":["../../../../../../../../node_modules/@amplitude/analytics-node/lib/esm/node-client.js"],"sourcesContent":["import { __assign, __awaiter, __extends, __generator } from \"tslib\";\nimport { AmplitudeCore, Destination, returnWrapper, debugWrapper, getClientLogConfig, getClientStates, } from '@amplitude/analytics-core';\nimport { Context } from './plugins/context';\nimport { useNodeConfig } from './config';\nvar AmplitudeNode = /** @class */ (function (_super) {\n    __extends(AmplitudeNode, _super);\n    function AmplitudeNode() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    AmplitudeNode.prototype.init = function (apiKey, options) {\n        if (apiKey === void 0) { apiKey = ''; }\n        return returnWrapper(this._init(__assign(__assign({}, options), { apiKey: apiKey })));\n    };\n    AmplitudeNode.prototype._init = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var nodeOptions;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // Step 0: Block concurrent initialization\n                        if (this.initializing) {\n                            return [2 /*return*/];\n                        }\n                        this.initializing = true;\n                        nodeOptions = useNodeConfig(options.apiKey, __assign({}, options));\n                        return [4 /*yield*/, _super.prototype._init.call(this, nodeOptions)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.add(new Destination()).promise];\n                    case 2:\n                        _a.sent();\n                        return [4 /*yield*/, this.add(new Context()).promise];\n                    case 3:\n                        _a.sent();\n                        this.initializing = false;\n                        return [4 /*yield*/, this.runQueuedFunctions('dispatchQ')];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return AmplitudeNode;\n}(AmplitudeCore));\nexport { AmplitudeNode };\nexport var createInstance = function () {\n    var client = new AmplitudeNode();\n    return {\n        init: debugWrapper(client.init.bind(client), 'init', getClientLogConfig(client), getClientStates(client, ['config'])),\n        add: debugWrapper(client.add.bind(client), 'add', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.plugins'])),\n        remove: debugWrapper(client.remove.bind(client), 'remove', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.plugins'])),\n        track: debugWrapper(client.track.bind(client), 'track', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.queue.length'])),\n        logEvent: debugWrapper(client.logEvent.bind(client), 'logEvent', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.queue.length'])),\n        identify: debugWrapper(client.identify.bind(client), 'identify', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.queue.length'])),\n        groupIdentify: debugWrapper(client.groupIdentify.bind(client), 'groupIdentify', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.queue.length'])),\n        setGroup: debugWrapper(client.setGroup.bind(client), 'setGroup', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.queue.length'])),\n        revenue: debugWrapper(client.revenue.bind(client), 'revenue', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.queue.length'])),\n        flush: debugWrapper(client.flush.bind(client), 'flush', getClientLogConfig(client), getClientStates(client, ['config.apiKey', 'timeline.queue.length'])),\n        setOptOut: debugWrapper(client.setOptOut.bind(client), 'setOptOut', getClientLogConfig(client), getClientStates(client, ['config'])),\n    };\n};\nexport default createInstance();\n//# sourceMappingURL=node-client.js.map"],"names":["__extends","AmplitudeNode","returnWrapper","__assign","__awaiter","__generator","useNodeConfig","Destination","Context","AmplitudeCore","client","debugWrapper","getClientLogConfig","getClientStates"],"mappings":";;;;;;;;;AAIG,IAAC;AAAA;AAAA,EAA+B,SAAU,QAAQ;AACjDA,wBAAUC,gBAAe,MAAM;AAC/B,aAASA,iBAAgB;AACrB,aAAO,WAAW,QAAQ,OAAO,MAAM,MAAM,SAAS,KAAK;AAAA,IAC9D;AACD,IAAAA,eAAc,UAAU,OAAO,SAAU,QAAQ,SAAS;AACtD,UAAI,WAAW,QAAQ;AAAE,iBAAS;AAAA,MAAK;AACvC,aAAOC,cAAa,cAAC,KAAK,MAAMC,UAAAA,SAASA,UAAAA,SAAS,CAAA,GAAI,OAAO,GAAG,EAAE,OAAgB,CAAA,CAAC,CAAC;AAAA,IAC5F;AACI,IAAAF,eAAc,UAAU,QAAQ,SAAU,SAAS;AAC/C,aAAOG,UAAS,UAAC,MAAM,QAAQ,QAAQ,WAAY;AAC/C,YAAI;AACJ,eAAOC,UAAW,YAAC,MAAM,SAAU,IAAI;AACnC,kBAAQ,GAAG,OAAK;AAAA,YACZ,KAAK;AAED,kBAAI,KAAK,cAAc;AACnB,uBAAO;AAAA,kBAAC;AAAA;AAAA,gBAAC;AAAA,cACZ;AACD,mBAAK,eAAe;AACpB,4BAAcC,OAAa,cAAC,QAAQ,QAAQH,UAAAA,SAAS,CAAE,GAAE,OAAO,CAAC;AACjE,qBAAO,CAAC,GAAa,OAAO,UAAU,MAAM,KAAK,MAAM,WAAW,CAAC;AAAA,YACvE,KAAK;AACD,iBAAG,KAAI;AACP,qBAAO,CAAC,GAAa,KAAK,IAAI,IAAII,wBAAa,CAAA,EAAE,OAAO;AAAA,YAC5D,KAAK;AACD,iBAAG,KAAI;AACP,qBAAO,CAAC,GAAa,KAAK,IAAI,IAAIC,gBAAS,CAAA,EAAE,OAAO;AAAA,YACxD,KAAK;AACD,iBAAG,KAAI;AACP,mBAAK,eAAe;AACpB,qBAAO,CAAC,GAAa,KAAK,mBAAmB,WAAW,CAAC;AAAA,YAC7D,KAAK;AACD,iBAAG,KAAI;AACP,qBAAO;AAAA,gBAAC;AAAA;AAAA,cAAC;AAAA,UAChB;AAAA,QACjB,CAAa;AAAA,MACb,CAAS;AAAA,IACT;AACI,WAAOP;AAAA,EACX,EAAEQ,WAAa,aAAA;AAAA;AAEL,IAAC,iBAAiB,WAAY;AACpC,MAAIC,UAAS,IAAI;AACjB,SAAO;AAAA,IACH,MAAMC,MAAY,aAACD,QAAO,KAAK,KAAKA,OAAM,GAAG,QAAQE,MAAAA,mBAAmBF,OAAM,GAAGG,MAAe,gBAACH,SAAQ,CAAC,QAAQ,CAAC,CAAC;AAAA,IACpH,KAAKC,MAAY,aAACD,QAAO,IAAI,KAAKA,OAAM,GAAG,OAAOE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,kBAAkB,CAAC,CAAC;AAAA,IAC5I,QAAQC,MAAY,aAACD,QAAO,OAAO,KAAKA,OAAM,GAAG,UAAUE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,kBAAkB,CAAC,CAAC;AAAA,IACrJ,OAAOC,MAAY,aAACD,QAAO,MAAM,KAAKA,OAAM,GAAG,SAASE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,uBAAuB,CAAC,CAAC;AAAA,IACvJ,UAAUC,MAAY,aAACD,QAAO,SAAS,KAAKA,OAAM,GAAG,YAAYE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,uBAAuB,CAAC,CAAC;AAAA,IAChK,UAAUC,MAAY,aAACD,QAAO,SAAS,KAAKA,OAAM,GAAG,YAAYE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,uBAAuB,CAAC,CAAC;AAAA,IAChK,eAAeC,MAAY,aAACD,QAAO,cAAc,KAAKA,OAAM,GAAG,iBAAiBE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,uBAAuB,CAAC,CAAC;AAAA,IAC/K,UAAUC,MAAY,aAACD,QAAO,SAAS,KAAKA,OAAM,GAAG,YAAYE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,uBAAuB,CAAC,CAAC;AAAA,IAChK,SAASC,MAAY,aAACD,QAAO,QAAQ,KAAKA,OAAM,GAAG,WAAWE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,uBAAuB,CAAC,CAAC;AAAA,IAC7J,OAAOC,MAAY,aAACD,QAAO,MAAM,KAAKA,OAAM,GAAG,SAASE,MAAkB,mBAACF,OAAM,GAAGG,MAAAA,gBAAgBH,SAAQ,CAAC,iBAAiB,uBAAuB,CAAC,CAAC;AAAA,IACvJ,WAAWC,MAAY,aAACD,QAAO,UAAU,KAAKA,OAAM,GAAG,aAAaE,MAAAA,mBAAmBF,OAAM,GAAGG,MAAe,gBAACH,SAAQ,CAAC,QAAQ,CAAC,CAAC;AAAA,EAC3I;AACA;AACA,MAAA,SAAe,eAAgB;;;;","x_google_ignoreList":[0]}