{"version":3,"file":"http.js","sources":["../../../../../../../../../node_modules/@amplitude/experiment-node-server/dist/src/transport/http.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WrapperClient = exports.FetchHttpClient = void 0;\nconst http_1 = __importDefault(require(\"http\"));\nconst https_1 = __importDefault(require(\"https\"));\nconst url_1 = __importDefault(require(\"url\"));\nconst defaultHttpAgent = new https_1.default.Agent({\n    keepAlive: true,\n});\nclass FetchHttpClient {\n    constructor(httpAgent) {\n        this.httpAgent = httpAgent || defaultHttpAgent;\n    }\n    /**\n     * Wraps the http and https libraries in a fetch()-like interface\n     * @param requestUrl\n     * @param method HTTP Method (GET, POST, etc.)\n     * @param headers HTTP Headers\n     * @param  Request body\n     */\n    request(requestUrl, method, headers, body, timeoutMillis) {\n        return new Promise((resolve, reject) => {\n            if (timeoutMillis === 0) {\n                reject(Error('Response timed out'));\n                return;\n            }\n            const urlParams = url_1.default.parse(requestUrl);\n            const options = Object.assign(Object.assign({}, urlParams), { method: method, headers: headers, body: body, agent: this.httpAgent, timeout: timeoutMillis });\n            const protocol = urlParams.protocol === 'http:' ? http_1.default : https_1.default;\n            const req = protocol.request(options);\n            req.on('response', (res) => {\n                res.setEncoding('utf-8');\n                let responseBody = '';\n                res.on('data', (chunk) => {\n                    responseBody += chunk;\n                });\n                res.on('end', () => {\n                    resolve({\n                        status: res.statusCode,\n                        body: responseBody,\n                    });\n                });\n            });\n            req.on('timeout', () => {\n                req.destroy(Error('Socket connection timed out'));\n            });\n            req.on('error', (e) => {\n                reject(e);\n            });\n            if (method !== 'GET' && body) {\n                req.write(body);\n            }\n            req.end();\n        });\n    }\n}\nexports.FetchHttpClient = FetchHttpClient;\n/**\n * Wrap the exposed HttpClient in a CoreClient implementation to work with\n * FlagApi and EvaluationApi.\n */\nclass WrapperClient {\n    constructor(client) {\n        this.client = client;\n    }\n    request(request) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return yield this.client.request(request.requestUrl, request.method, request.headers, null, request.timeoutMillis);\n        });\n    }\n}\nexports.WrapperClient = WrapperClient;\n"],"names":["this","require$$0","require$$1"],"mappings":"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","x_google_ignoreList":[0]}