{"version":3,"file":"cache.js","sources":["../../../../../../../../../node_modules/@amplitude/experiment-node-server/dist/src/util/cache.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Cache = void 0;\nclass ListNode {\n    constructor(data) {\n        this.prev = undefined;\n        this.next = undefined;\n        this.data = data;\n    }\n}\nclass Cache {\n    constructor(capacity, ttlMillis) {\n        this.capacity = capacity;\n        this.ttlMillis = ttlMillis;\n        this.cache = new Map();\n        this.head = undefined;\n        this.tail = undefined;\n    }\n    put(key, value) {\n        if (this.cache.has(key)) {\n            this.removeFromList(key);\n        }\n        else if (this.cache.size >= this.capacity) {\n            this.evictLRU();\n        }\n        const cacheItem = {\n            key,\n            value,\n            createdAt: Date.now(),\n        };\n        const node = new ListNode(cacheItem);\n        this.cache.set(key, node);\n        this.insertToList(node);\n    }\n    get(key) {\n        const node = this.cache.get(key);\n        if (node) {\n            const timeElapsed = Date.now() - node.data.createdAt;\n            if (timeElapsed > this.ttlMillis) {\n                this.remove(key);\n                return undefined;\n            }\n            this.removeFromList(key);\n            this.insertToList(node);\n            return node.data.value;\n        }\n        return undefined;\n    }\n    remove(key) {\n        this.removeFromList(key);\n        this.cache.delete(key);\n    }\n    clear() {\n        this.cache.clear();\n        this.head = undefined;\n        this.tail = undefined;\n    }\n    evictLRU() {\n        if (this.head) {\n            this.remove(this.head.data.key);\n        }\n    }\n    removeFromList(key) {\n        const node = this.cache.get(key);\n        if (node) {\n            if (node.prev) {\n                node.prev.next = node.next;\n            }\n            else {\n                this.head = node.next;\n            }\n            if (node.next) {\n                node.next.prev = node.prev;\n            }\n            else {\n                this.tail = node.prev;\n            }\n        }\n    }\n    insertToList(node) {\n        if (this.tail) {\n            this.tail.next = node;\n            node.prev = this.tail;\n            node.next = undefined;\n            this.tail = node;\n        }\n        else {\n            this.head = node;\n            this.tail = node;\n        }\n    }\n}\nexports.Cache = Cache;\n"],"names":[],"mappings":";AACA,OAAO,eAAe,OAAS,cAAc,EAAE,OAAO,KAAI,CAAE;AAC/C,MAAA,QAAG;AAChB,MAAM,SAAS;AAAA,EACX,YAAY,MAAM;AACd,SAAK,OAAO;AACZ,SAAK,OAAO;AACZ,SAAK,OAAO;AAAA,EACf;AACL;AACA,MAAM,MAAM;AAAA,EACR,YAAY,UAAU,WAAW;AAC7B,SAAK,WAAW;AAChB,SAAK,YAAY;AACjB,SAAK,QAAQ,oBAAI;AACjB,SAAK,OAAO;AACZ,SAAK,OAAO;AAAA,EACf;AAAA,EACD,IAAI,KAAK,OAAO;AACZ,QAAI,KAAK,MAAM,IAAI,GAAG,GAAG;AACrB,WAAK,eAAe,GAAG;AAAA,IAC1B,WACQ,KAAK,MAAM,QAAQ,KAAK,UAAU;AACvC,WAAK,SAAQ;AAAA,IAChB;AACD,UAAM,YAAY;AAAA,MACd;AAAA,MACA;AAAA,MACA,WAAW,KAAK,IAAK;AAAA,IACjC;AACQ,UAAM,OAAO,IAAI,SAAS,SAAS;AACnC,SAAK,MAAM,IAAI,KAAK,IAAI;AACxB,SAAK,aAAa,IAAI;AAAA,EACzB;AAAA,EACD,IAAI,KAAK;AACL,UAAM,OAAO,KAAK,MAAM,IAAI,GAAG;AAC/B,QAAI,MAAM;AACN,YAAM,cAAc,KAAK,IAAK,IAAG,KAAK,KAAK;AAC3C,UAAI,cAAc,KAAK,WAAW;AAC9B,aAAK,OAAO,GAAG;AACf,eAAO;AAAA,MACV;AACD,WAAK,eAAe,GAAG;AACvB,WAAK,aAAa,IAAI;AACtB,aAAO,KAAK,KAAK;AAAA,IACpB;AACD,WAAO;AAAA,EACV;AAAA,EACD,OAAO,KAAK;AACR,SAAK,eAAe,GAAG;AACvB,SAAK,MAAM,OAAO,GAAG;AAAA,EACxB;AAAA,EACD,QAAQ;AACJ,SAAK,MAAM;AACX,SAAK,OAAO;AACZ,SAAK,OAAO;AAAA,EACf;AAAA,EACD,WAAW;AACP,QAAI,KAAK,MAAM;AACX,WAAK,OAAO,KAAK,KAAK,KAAK,GAAG;AAAA,IACjC;AAAA,EACJ;AAAA,EACD,eAAe,KAAK;AAChB,UAAM,OAAO,KAAK,MAAM,IAAI,GAAG;AAC/B,QAAI,MAAM;AACN,UAAI,KAAK,MAAM;AACX,aAAK,KAAK,OAAO,KAAK;AAAA,MACzB,OACI;AACD,aAAK,OAAO,KAAK;AAAA,MACpB;AACD,UAAI,KAAK,MAAM;AACX,aAAK,KAAK,OAAO,KAAK;AAAA,MACzB,OACI;AACD,aAAK,OAAO,KAAK;AAAA,MACpB;AAAA,IACJ;AAAA,EACJ;AAAA,EACD,aAAa,MAAM;AACf,QAAI,KAAK,MAAM;AACX,WAAK,KAAK,OAAO;AACjB,WAAK,OAAO,KAAK;AACjB,WAAK,OAAO;AACZ,WAAK,OAAO;AAAA,IACf,OACI;AACD,WAAK,OAAO;AACZ,WAAK,OAAO;AAAA,IACf;AAAA,EACJ;AACL;AACA,MAAA,QAAgB;","x_google_ignoreList":[0]}