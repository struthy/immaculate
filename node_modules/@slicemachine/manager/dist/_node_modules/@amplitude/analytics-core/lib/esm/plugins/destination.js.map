{"version":3,"file":"destination.js","sources":["../../../../../../../../../node_modules/@amplitude/analytics-core/lib/esm/plugins/destination.js"],"sourcesContent":["import { __awaiter, __generator, __read, __rest, __spreadArray } from \"tslib\";\nimport { PluginType, Status, } from '@amplitude/analytics-types';\nimport { INVALID_API_KEY, MAX_RETRIES_EXCEEDED_MESSAGE, MISSING_API_KEY_MESSAGE, SUCCESS_MESSAGE, UNEXPECTED_ERROR_MESSAGE, } from '../messages';\nimport { STORAGE_PREFIX } from '../constants';\nimport { chunk } from '../utils/chunk';\nimport { buildResult } from '../utils/result-builder';\nimport { createServerConfig } from '../config';\nfunction getErrorMessage(error) {\n    if (error instanceof Error)\n        return error.message;\n    return String(error);\n}\nexport function getResponseBodyString(res) {\n    var responseBodyString = '';\n    try {\n        if ('body' in res) {\n            responseBodyString = JSON.stringify(res.body);\n        }\n    }\n    catch (_a) {\n        // to avoid crash, but don't care about the error, add comment to avoid empty block lint error\n    }\n    return responseBodyString;\n}\nvar Destination = /** @class */ (function () {\n    function Destination() {\n        this.name = 'amplitude';\n        this.type = PluginType.DESTINATION;\n        this.retryTimeout = 1000;\n        this.throttleTimeout = 30000;\n        this.storageKey = '';\n        this.scheduled = null;\n        this.queue = [];\n    }\n    Destination.prototype.setup = function (config) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var unsent;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        this.config = config;\n                        this.storageKey = \"\".concat(STORAGE_PREFIX, \"_\").concat(this.config.apiKey.substring(0, 10));\n                        return [4 /*yield*/, ((_a = this.config.storageProvider) === null || _a === void 0 ? void 0 : _a.get(this.storageKey))];\n                    case 1:\n                        unsent = _b.sent();\n                        this.saveEvents(); // sets storage to '[]'\n                        if (unsent && unsent.length > 0) {\n                            void Promise.all(unsent.map(function (event) { return _this.execute(event); })).catch();\n                        }\n                        return [2 /*return*/, Promise.resolve(undefined)];\n                }\n            });\n        });\n    };\n    Destination.prototype.execute = function (event) {\n        var _this = this;\n        return new Promise(function (resolve) {\n            var context = {\n                event: event,\n                attempts: 0,\n                callback: function (result) { return resolve(result); },\n                timeout: 0,\n            };\n            void _this.addToQueue(context);\n        });\n    };\n    Destination.prototype.addToQueue = function () {\n        var _this = this;\n        var list = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            list[_i] = arguments[_i];\n        }\n        var tryable = list.filter(function (context) {\n            if (context.attempts < _this.config.flushMaxRetries) {\n                context.attempts += 1;\n                return true;\n            }\n            void _this.fulfillRequest([context], 500, MAX_RETRIES_EXCEEDED_MESSAGE);\n            return false;\n        });\n        tryable.forEach(function (context) {\n            _this.queue = _this.queue.concat(context);\n            if (context.timeout === 0) {\n                _this.schedule(_this.config.flushIntervalMillis);\n                return;\n            }\n            setTimeout(function () {\n                context.timeout = 0;\n                _this.schedule(0);\n            }, context.timeout);\n        });\n        this.saveEvents();\n    };\n    Destination.prototype.schedule = function (timeout) {\n        var _this = this;\n        if (this.scheduled)\n            return;\n        this.scheduled = setTimeout(function () {\n            void _this.flush(true).then(function () {\n                if (_this.queue.length > 0) {\n                    _this.schedule(timeout);\n                }\n            });\n        }, timeout);\n    };\n    Destination.prototype.flush = function (useRetry) {\n        if (useRetry === void 0) { useRetry = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var list, later, batches;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        list = [];\n                        later = [];\n                        this.queue.forEach(function (context) { return (context.timeout === 0 ? list.push(context) : later.push(context)); });\n                        this.queue = later;\n                        if (this.scheduled) {\n                            clearTimeout(this.scheduled);\n                            this.scheduled = null;\n                        }\n                        batches = chunk(list, this.config.flushQueueSize);\n                        return [4 /*yield*/, Promise.all(batches.map(function (batch) { return _this.send(batch, useRetry); }))];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Destination.prototype.send = function (list, useRetry) {\n        if (useRetry === void 0) { useRetry = true; }\n        return __awaiter(this, void 0, void 0, function () {\n            var payload, serverUrl, res, e_1, errorMessage;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.config.apiKey) {\n                            return [2 /*return*/, this.fulfillRequest(list, 400, MISSING_API_KEY_MESSAGE)];\n                        }\n                        payload = {\n                            api_key: this.config.apiKey,\n                            events: list.map(function (context) {\n                                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                                var _a = context.event, extra = _a.extra, eventWithoutExtra = __rest(_a, [\"extra\"]);\n                                return eventWithoutExtra;\n                            }),\n                            options: {\n                                min_id_length: this.config.minIdLength,\n                            },\n                        };\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        serverUrl = createServerConfig(this.config.serverUrl, this.config.serverZone, this.config.useBatch).serverUrl;\n                        return [4 /*yield*/, this.config.transportProvider.send(serverUrl, payload)];\n                    case 2:\n                        res = _a.sent();\n                        if (res === null) {\n                            this.fulfillRequest(list, 0, UNEXPECTED_ERROR_MESSAGE);\n                            return [2 /*return*/];\n                        }\n                        if (!useRetry) {\n                            if ('body' in res) {\n                                this.fulfillRequest(list, res.statusCode, \"\".concat(res.status, \": \").concat(getResponseBodyString(res)));\n                            }\n                            else {\n                                this.fulfillRequest(list, res.statusCode, res.status);\n                            }\n                            return [2 /*return*/];\n                        }\n                        this.handleResponse(res, list);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _a.sent();\n                        this.config.loggerProvider.error(e_1);\n                        errorMessage = getErrorMessage(e_1);\n                        this.fulfillRequest(list, 0, errorMessage);\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Destination.prototype.handleResponse = function (res, list) {\n        var status = res.status;\n        switch (status) {\n            case Status.Success: {\n                this.handleSuccessResponse(res, list);\n                break;\n            }\n            case Status.Invalid: {\n                this.handleInvalidResponse(res, list);\n                break;\n            }\n            case Status.PayloadTooLarge: {\n                this.handlePayloadTooLargeResponse(res, list);\n                break;\n            }\n            case Status.RateLimit: {\n                this.handleRateLimitResponse(res, list);\n                break;\n            }\n            default: {\n                // log intermediate event status before retry\n                this.config.loggerProvider.warn(\"{code: 0, error: \\\"Status '\".concat(status, \"' provided for \").concat(list.length, \" events\\\"}\"));\n                this.handleOtherResponse(list);\n                break;\n            }\n        }\n    };\n    Destination.prototype.handleSuccessResponse = function (res, list) {\n        this.fulfillRequest(list, res.statusCode, SUCCESS_MESSAGE);\n    };\n    Destination.prototype.handleInvalidResponse = function (res, list) {\n        var _this = this;\n        if (res.body.missingField || res.body.error.startsWith(INVALID_API_KEY)) {\n            this.fulfillRequest(list, res.statusCode, res.body.error);\n            return;\n        }\n        var dropIndex = __spreadArray(__spreadArray(__spreadArray(__spreadArray([], __read(Object.values(res.body.eventsWithInvalidFields)), false), __read(Object.values(res.body.eventsWithMissingFields)), false), __read(Object.values(res.body.eventsWithInvalidIdLengths)), false), __read(res.body.silencedEvents), false).flat();\n        var dropIndexSet = new Set(dropIndex);\n        var retry = list.filter(function (context, index) {\n            if (dropIndexSet.has(index)) {\n                _this.fulfillRequest([context], res.statusCode, res.body.error);\n                return;\n            }\n            return true;\n        });\n        if (retry.length > 0) {\n            // log intermediate event status before retry\n            this.config.loggerProvider.warn(getResponseBodyString(res));\n        }\n        this.addToQueue.apply(this, __spreadArray([], __read(retry), false));\n    };\n    Destination.prototype.handlePayloadTooLargeResponse = function (res, list) {\n        if (list.length === 1) {\n            this.fulfillRequest(list, res.statusCode, res.body.error);\n            return;\n        }\n        // log intermediate event status before retry\n        this.config.loggerProvider.warn(getResponseBodyString(res));\n        this.config.flushQueueSize /= 2;\n        this.addToQueue.apply(this, __spreadArray([], __read(list), false));\n    };\n    Destination.prototype.handleRateLimitResponse = function (res, list) {\n        var _this = this;\n        var dropUserIds = Object.keys(res.body.exceededDailyQuotaUsers);\n        var dropDeviceIds = Object.keys(res.body.exceededDailyQuotaDevices);\n        var throttledIndex = res.body.throttledEvents;\n        var dropUserIdsSet = new Set(dropUserIds);\n        var dropDeviceIdsSet = new Set(dropDeviceIds);\n        var throttledIndexSet = new Set(throttledIndex);\n        var retry = list.filter(function (context, index) {\n            if ((context.event.user_id && dropUserIdsSet.has(context.event.user_id)) ||\n                (context.event.device_id && dropDeviceIdsSet.has(context.event.device_id))) {\n                _this.fulfillRequest([context], res.statusCode, res.body.error);\n                return;\n            }\n            if (throttledIndexSet.has(index)) {\n                context.timeout = _this.throttleTimeout;\n            }\n            return true;\n        });\n        if (retry.length > 0) {\n            // log intermediate event status before retry\n            this.config.loggerProvider.warn(getResponseBodyString(res));\n        }\n        this.addToQueue.apply(this, __spreadArray([], __read(retry), false));\n    };\n    Destination.prototype.handleOtherResponse = function (list) {\n        var _this = this;\n        this.addToQueue.apply(this, __spreadArray([], __read(list.map(function (context) {\n            context.timeout = context.attempts * _this.retryTimeout;\n            return context;\n        })), false));\n    };\n    Destination.prototype.fulfillRequest = function (list, code, message) {\n        this.saveEvents();\n        list.forEach(function (context) { return context.callback(buildResult(context.event, code, message)); });\n    };\n    /**\n     * Saves events to storage\n     * This is called on\n     * 1) new events are added to queue; or\n     * 2) response comes back for a request\n     */\n    Destination.prototype.saveEvents = function () {\n        if (!this.config.storageProvider) {\n            return;\n        }\n        var events = Array.from(this.queue.map(function (context) { return context.event; }));\n        void this.config.storageProvider.set(this.storageKey, events);\n    };\n    return Destination;\n}());\nexport { Destination };\n//# sourceMappingURL=destination.js.map"],"names":["Destination","_a"],"mappings":"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","x_google_ignoreList":[0]}