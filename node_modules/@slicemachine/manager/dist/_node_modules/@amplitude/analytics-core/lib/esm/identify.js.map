{"version":3,"file":"identify.js","sources":["../../../../../../../../node_modules/@amplitude/analytics-core/lib/esm/identify.js"],"sourcesContent":["import { __assign } from \"tslib\";\nimport { IdentifyOperation, } from '@amplitude/analytics-types';\nimport { UNSET_VALUE } from './constants';\nimport { isValidProperties } from './utils/valid-properties';\nvar Identify = /** @class */ (function () {\n    function Identify() {\n        this._propertySet = new Set();\n        this._properties = {};\n    }\n    Identify.prototype.getUserProperties = function () {\n        return __assign({}, this._properties);\n    };\n    Identify.prototype.set = function (property, value) {\n        this._safeSet(IdentifyOperation.SET, property, value);\n        return this;\n    };\n    Identify.prototype.setOnce = function (property, value) {\n        this._safeSet(IdentifyOperation.SET_ONCE, property, value);\n        return this;\n    };\n    Identify.prototype.append = function (property, value) {\n        this._safeSet(IdentifyOperation.APPEND, property, value);\n        return this;\n    };\n    Identify.prototype.prepend = function (property, value) {\n        this._safeSet(IdentifyOperation.PREPEND, property, value);\n        return this;\n    };\n    Identify.prototype.postInsert = function (property, value) {\n        this._safeSet(IdentifyOperation.POSTINSERT, property, value);\n        return this;\n    };\n    Identify.prototype.preInsert = function (property, value) {\n        this._safeSet(IdentifyOperation.PREINSERT, property, value);\n        return this;\n    };\n    Identify.prototype.remove = function (property, value) {\n        this._safeSet(IdentifyOperation.REMOVE, property, value);\n        return this;\n    };\n    Identify.prototype.add = function (property, value) {\n        this._safeSet(IdentifyOperation.ADD, property, value);\n        return this;\n    };\n    Identify.prototype.unset = function (property) {\n        this._safeSet(IdentifyOperation.UNSET, property, UNSET_VALUE);\n        return this;\n    };\n    Identify.prototype.clearAll = function () {\n        // When clear all happens, all properties are unset. Reset the entire object.\n        this._properties = {};\n        this._properties[IdentifyOperation.CLEAR_ALL] = UNSET_VALUE;\n        return this;\n    };\n    // Returns whether or not this set actually worked.\n    Identify.prototype._safeSet = function (operation, property, value) {\n        if (this._validate(operation, property, value)) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            var userPropertyMap = this._properties[operation];\n            if (userPropertyMap === undefined) {\n                userPropertyMap = {};\n                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n                this._properties[operation] = userPropertyMap;\n            }\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            userPropertyMap[property] = value;\n            this._propertySet.add(property);\n            return true;\n        }\n        return false;\n    };\n    Identify.prototype._validate = function (operation, property, value) {\n        if (this._properties[IdentifyOperation.CLEAR_ALL] !== undefined) {\n            // clear all already set. Skipping operation;\n            return false;\n        }\n        if (this._propertySet.has(property)) {\n            // Property already used. Skipping operation\n            return false;\n        }\n        if (operation === IdentifyOperation.ADD) {\n            return typeof value === 'number';\n        }\n        if (operation !== IdentifyOperation.UNSET && operation !== IdentifyOperation.REMOVE) {\n            return isValidProperties(property, value);\n        }\n        return true;\n    };\n    return Identify;\n}());\nexport { Identify };\n//# sourceMappingURL=identify.js.map"],"names":["Identify"],"mappings":";;;;AAIG,IAAC;AAAA;AAAA,EAA0B,WAAY;AACtC,aAASA,YAAW;AAChB,WAAK,eAAe,oBAAI;AACxB,WAAK,cAAc;IACtB;AACD,IAAAA,UAAS,UAAU,oBAAoB,WAAY;AAC/C,aAAO,SAAS,CAAA,GAAI,KAAK,WAAW;AAAA,IAC5C;AACI,IAAAA,UAAS,UAAU,MAAM,SAAU,UAAU,OAAO;AAChD,WAAK,SAAS,kBAAkB,KAAK,UAAU,KAAK;AACpD,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,UAAU,SAAU,UAAU,OAAO;AACpD,WAAK,SAAS,kBAAkB,UAAU,UAAU,KAAK;AACzD,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,SAAS,SAAU,UAAU,OAAO;AACnD,WAAK,SAAS,kBAAkB,QAAQ,UAAU,KAAK;AACvD,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,UAAU,SAAU,UAAU,OAAO;AACpD,WAAK,SAAS,kBAAkB,SAAS,UAAU,KAAK;AACxD,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,aAAa,SAAU,UAAU,OAAO;AACvD,WAAK,SAAS,kBAAkB,YAAY,UAAU,KAAK;AAC3D,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,YAAY,SAAU,UAAU,OAAO;AACtD,WAAK,SAAS,kBAAkB,WAAW,UAAU,KAAK;AAC1D,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,SAAS,SAAU,UAAU,OAAO;AACnD,WAAK,SAAS,kBAAkB,QAAQ,UAAU,KAAK;AACvD,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,MAAM,SAAU,UAAU,OAAO;AAChD,WAAK,SAAS,kBAAkB,KAAK,UAAU,KAAK;AACpD,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,QAAQ,SAAU,UAAU;AAC3C,WAAK,SAAS,kBAAkB,OAAO,UAAU,WAAW;AAC5D,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,WAAW,WAAY;AAEtC,WAAK,cAAc;AACnB,WAAK,YAAY,kBAAkB,SAAS,IAAI;AAChD,aAAO;AAAA,IACf;AAEI,IAAAA,UAAS,UAAU,WAAW,SAAU,WAAW,UAAU,OAAO;AAChE,UAAI,KAAK,UAAU,WAAW,UAAU,KAAK,GAAG;AAE5C,YAAI,kBAAkB,KAAK,YAAY,SAAS;AAChD,YAAI,oBAAoB,QAAW;AAC/B,4BAAkB,CAAA;AAElB,eAAK,YAAY,SAAS,IAAI;AAAA,QACjC;AAED,wBAAgB,QAAQ,IAAI;AAC5B,aAAK,aAAa,IAAI,QAAQ;AAC9B,eAAO;AAAA,MACV;AACD,aAAO;AAAA,IACf;AACI,IAAAA,UAAS,UAAU,YAAY,SAAU,WAAW,UAAU,OAAO;AACjE,UAAI,KAAK,YAAY,kBAAkB,SAAS,MAAM,QAAW;AAE7D,eAAO;AAAA,MACV;AACD,UAAI,KAAK,aAAa,IAAI,QAAQ,GAAG;AAEjC,eAAO;AAAA,MACV;AACD,UAAI,cAAc,kBAAkB,KAAK;AACrC,eAAO,OAAO,UAAU;AAAA,MAC3B;AACD,UAAI,cAAc,kBAAkB,SAAS,cAAc,kBAAkB,QAAQ;AACjF,eAAO,kBAAkB,UAAU,KAAK;AAAA,MAC3C;AACD,aAAO;AAAA,IACf;AACI,WAAOA;AAAA,EACX,EAAG;AAAA;","x_google_ignoreList":[0]}