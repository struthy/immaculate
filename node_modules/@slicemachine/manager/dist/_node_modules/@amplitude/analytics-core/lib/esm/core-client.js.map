{"version":3,"file":"core-client.js","sources":["../../../../../../../../node_modules/@amplitude/analytics-core/lib/esm/core-client.js"],"sourcesContent":["import { __awaiter, __generator, __values } from \"tslib\";\nimport { createGroupIdentifyEvent, createIdentifyEvent, createTrackEvent, createRevenueEvent, createGroupEvent, } from './utils/event-builder';\nimport { Timeline } from './timeline';\nimport { buildResult } from './utils/result-builder';\nimport { CLIENT_NOT_INITIALIZED, OPT_OUT_MESSAGE } from './messages';\nimport { returnWrapper } from './utils/return-wrapper';\nvar AmplitudeCore = /** @class */ (function () {\n    function AmplitudeCore(name) {\n        if (name === void 0) { name = '$default'; }\n        this.initializing = false;\n        this.q = [];\n        this.dispatchQ = [];\n        this.logEvent = this.track.bind(this);\n        this.timeline = new Timeline(this);\n        this.name = name;\n    }\n    AmplitudeCore.prototype._init = function (config) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.config = config;\n                        this.timeline.reset(this);\n                        return [4 /*yield*/, this.runQueuedFunctions('q')];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AmplitudeCore.prototype.runQueuedFunctions = function (queueName) {\n        return __awaiter(this, void 0, void 0, function () {\n            var queuedFunctions, queuedFunctions_1, queuedFunctions_1_1, queuedFunction, e_1_1;\n            var e_1, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        queuedFunctions = this[queueName];\n                        this[queueName] = [];\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 6, 7, 8]);\n                        queuedFunctions_1 = __values(queuedFunctions), queuedFunctions_1_1 = queuedFunctions_1.next();\n                        _b.label = 2;\n                    case 2:\n                        if (!!queuedFunctions_1_1.done) return [3 /*break*/, 5];\n                        queuedFunction = queuedFunctions_1_1.value;\n                        return [4 /*yield*/, queuedFunction()];\n                    case 3:\n                        _b.sent();\n                        _b.label = 4;\n                    case 4:\n                        queuedFunctions_1_1 = queuedFunctions_1.next();\n                        return [3 /*break*/, 2];\n                    case 5: return [3 /*break*/, 8];\n                    case 6:\n                        e_1_1 = _b.sent();\n                        e_1 = { error: e_1_1 };\n                        return [3 /*break*/, 8];\n                    case 7:\n                        try {\n                            if (queuedFunctions_1_1 && !queuedFunctions_1_1.done && (_a = queuedFunctions_1.return)) _a.call(queuedFunctions_1);\n                        }\n                        finally { if (e_1) throw e_1.error; }\n                        return [7 /*endfinally*/];\n                    case 8: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AmplitudeCore.prototype.track = function (eventInput, eventProperties, eventOptions) {\n        var event = createTrackEvent(eventInput, eventProperties, eventOptions);\n        return returnWrapper(this.dispatch(event));\n    };\n    AmplitudeCore.prototype.identify = function (identify, eventOptions) {\n        var event = createIdentifyEvent(identify, eventOptions);\n        return returnWrapper(this.dispatch(event));\n    };\n    AmplitudeCore.prototype.groupIdentify = function (groupType, groupName, identify, eventOptions) {\n        var event = createGroupIdentifyEvent(groupType, groupName, identify, eventOptions);\n        return returnWrapper(this.dispatch(event));\n    };\n    AmplitudeCore.prototype.setGroup = function (groupType, groupName, eventOptions) {\n        var event = createGroupEvent(groupType, groupName, eventOptions);\n        return returnWrapper(this.dispatch(event));\n    };\n    AmplitudeCore.prototype.revenue = function (revenue, eventOptions) {\n        var event = createRevenueEvent(revenue, eventOptions);\n        return returnWrapper(this.dispatch(event));\n    };\n    AmplitudeCore.prototype.add = function (plugin) {\n        if (!this.config) {\n            this.q.push(this.add.bind(this, plugin));\n            return returnWrapper();\n        }\n        return returnWrapper(this.timeline.register(plugin, this.config));\n    };\n    AmplitudeCore.prototype.remove = function (pluginName) {\n        if (!this.config) {\n            this.q.push(this.remove.bind(this, pluginName));\n            return returnWrapper();\n        }\n        return returnWrapper(this.timeline.deregister(pluginName));\n    };\n    AmplitudeCore.prototype.dispatchWithCallback = function (event, callback) {\n        if (!this.config) {\n            return callback(buildResult(event, 0, CLIENT_NOT_INITIALIZED));\n        }\n        void this.process(event).then(callback);\n    };\n    AmplitudeCore.prototype.dispatch = function (event) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                if (!this.config) {\n                    return [2 /*return*/, new Promise(function (resolve) {\n                            _this.dispatchQ.push(_this.dispatchWithCallback.bind(_this, event, resolve));\n                        })];\n                }\n                return [2 /*return*/, this.process(event)];\n            });\n        });\n    };\n    AmplitudeCore.prototype.process = function (event) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result, e_2, message, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        // skip event processing if opt out\n                        if (this.config.optOut) {\n                            return [2 /*return*/, buildResult(event, 0, OPT_OUT_MESSAGE)];\n                        }\n                        return [4 /*yield*/, this.timeline.push(event)];\n                    case 1:\n                        result = _a.sent();\n                        result.code === 200\n                            ? this.config.loggerProvider.log(result.message)\n                            : this.config.loggerProvider.error(result.message);\n                        return [2 /*return*/, result];\n                    case 2:\n                        e_2 = _a.sent();\n                        this.config.loggerProvider.error(e_2);\n                        message = String(e_2);\n                        result = buildResult(event, 0, message);\n                        return [2 /*return*/, result];\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AmplitudeCore.prototype.setOptOut = function (optOut) {\n        if (!this.config) {\n            this.q.push(this.setOptOut.bind(this, Boolean(optOut)));\n            return;\n        }\n        this.config.optOut = Boolean(optOut);\n    };\n    AmplitudeCore.prototype.flush = function () {\n        return returnWrapper(this.timeline.flush());\n    };\n    return AmplitudeCore;\n}());\nexport { AmplitudeCore };\n//# sourceMappingURL=core-client.js.map"],"names":["AmplitudeCore"],"mappings":"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","x_google_ignoreList":[0]}