{"version":3,"file":"index.cjs","sources":["../../../../../node_modules/get-stream/index.js"],"sourcesContent":["'use strict';\nconst {constants: BufferConstants} = require('buffer');\nconst stream = require('stream');\nconst {promisify} = require('util');\nconst bufferStream = require('./buffer-stream');\n\nconst streamPipelinePromisified = promisify(stream.pipeline);\n\nclass MaxBufferError extends Error {\n\tconstructor() {\n\t\tsuper('maxBuffer exceeded');\n\t\tthis.name = 'MaxBufferError';\n\t}\n}\n\nasync function getStream(inputStream, options) {\n\tif (!inputStream) {\n\t\tthrow new Error('Expected a stream');\n\t}\n\n\toptions = {\n\t\tmaxBuffer: Infinity,\n\t\t...options\n\t};\n\n\tconst {maxBuffer} = options;\n\tconst stream = bufferStream(options);\n\n\tawait new Promise((resolve, reject) => {\n\t\tconst rejectPromise = error => {\n\t\t\t// Don't retrieve an oversized buffer.\n\t\t\tif (error && stream.getBufferedLength() <= BufferConstants.MAX_LENGTH) {\n\t\t\t\terror.bufferedData = stream.getBufferedValue();\n\t\t\t}\n\n\t\t\treject(error);\n\t\t};\n\n\t\t(async () => {\n\t\t\ttry {\n\t\t\t\tawait streamPipelinePromisified(inputStream, stream);\n\t\t\t\tresolve();\n\t\t\t} catch (error) {\n\t\t\t\trejectPromise(error);\n\t\t\t}\n\t\t})();\n\n\t\tstream.on('data', () => {\n\t\t\tif (stream.getBufferedLength() > maxBuffer) {\n\t\t\t\trejectPromise(new MaxBufferError());\n\t\t\t}\n\t\t});\n\t});\n\n\treturn stream.getBufferedValue();\n}\n\nmodule.exports = getStream;\nmodule.exports.buffer = (stream, options) => getStream(stream, {...options, encoding: 'buffer'});\nmodule.exports.array = (stream, options) => getStream(stream, {...options, array: true});\nmodule.exports.MaxBufferError = MaxBufferError;\n"],"names":["require$$0","require$$1","require$$3","stream","getStreamModule"],"mappings":";;;;;;;AACA,MAAM,EAAC,WAAW,gBAAe,IAAIA;AACrC,MAAM,SAASC;AACf,MAAM,EAAC,UAAS,IAAI;AACpB,MAAM,eAAeC,eAAAA;AAErB,MAAM,4BAA4B,UAAU,OAAO,QAAQ;AAE3D,MAAM,uBAAuB,MAAM;AAAA,EAClC,cAAc;AACb,UAAM,oBAAoB;AAC1B,SAAK,OAAO;AAAA,EACZ;AACF;AAEA,eAAe,UAAU,aAAa,SAAS;AAC9C,MAAI,CAAC,aAAa;AACjB,UAAM,IAAI,MAAM,mBAAmB;AAAA,EACnC;AAED,YAAU;AAAA,IACT,WAAW;AAAA,IACX,GAAG;AAAA,EACL;AAEC,QAAM,EAAC,UAAS,IAAI;AACpB,QAAMC,UAAS,aAAa,OAAO;AAEnC,QAAM,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAM,gBAAgB,WAAS;AAE9B,UAAI,SAASA,QAAO,kBAAiB,KAAM,gBAAgB,YAAY;AACtE,cAAM,eAAeA,QAAO;MAC5B;AAED,aAAO,KAAK;AAAA,IACf;AAEE,KAAC,YAAY;AACZ,UAAI;AACH,cAAM,0BAA0B,aAAaA,OAAM;AACnD;MACA,SAAQ,OAAP;AACD,sBAAc,KAAK;AAAA,MACnB;AAAA,IACJ;AAEE,IAAAA,QAAO,GAAG,QAAQ,MAAM;AACvB,UAAIA,QAAO,kBAAmB,IAAG,WAAW;AAC3C,sBAAc,IAAI,eAAc,CAAE;AAAA,MAClC;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AAED,SAAOA,QAAO;AACf;AAEAC,MAAAA,SAAc,UAAG;AACjBA,MAAA,SAAA,QAAA,SAAwB,CAACD,SAAQ,YAAY,UAAUA,SAAQ,EAAC,GAAG,SAAS,UAAU,SAAQ,CAAC;AAC/FC,MAAA,SAAA,QAAA,QAAuB,CAACD,SAAQ,YAAY,UAAUA,SAAQ,EAAC,GAAG,SAAS,OAAO,KAAI,CAAC;AACvFC,MAAAA,SAAA,QAAA,iBAAgC;;;;","x_google_ignoreList":[0]}