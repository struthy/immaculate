{"version":3,"file":"prismicrc.js","sources":["../../../src/lib/prismicrc.ts"],"sourcesContent":["import * as path from \"node:path\";\nimport * as t from \"io-ts\";\nimport * as rc9 from \"rc9\";\n\nimport { decode } from \"./decode\";\n\nconst PRISMICRC = \".prismicrc\";\n\nconst Prismicrc = t.partial({\n\ttelemetry: t.boolean,\n});\ntype Prismicrc = t.TypeOf<typeof Prismicrc>;\n\nexport const readRawPrismicrc = (dir?: string): Prismicrc => {\n\tconst rawPrismicrc = dir\n\t\t? rc9.read({ dir, name: PRISMICRC })\n\t\t: rc9.readUser(PRISMICRC);\n\n\tconst { value: prismicrc, error } = decode(Prismicrc, rawPrismicrc);\n\n\tif (error) {\n\t\tthrow new Error(\n\t\t\t`Failed to parse ${\n\t\t\t\tdir ? path.resolve(dir, PRISMICRC) : `~/${PRISMICRC}`\n\t\t\t}: ${error.errors.join(\", \")}`,\n\t\t);\n\t}\n\n\treturn prismicrc;\n};\n\nexport const readPrismicrc = (dir: string): Prismicrc => {\n\tconst userPrismicrc = readRawPrismicrc();\n\tconst projectPrismicrc = readRawPrismicrc(dir);\n\n\treturn {\n\t\t...userPrismicrc,\n\t\t...projectPrismicrc,\n\t};\n};\n\nexport const writePrismicrc = (config: Prismicrc, dir?: string): void => {\n\tconst { value: validatedConfig, error } = decode(Prismicrc, config);\n\n\tif (error) {\n\t\tthrow new Error(`Failed to validate config: ${error.errors.join(\", \")}`);\n\t}\n\n\tdir\n\t\t? rc9.write(validatedConfig, { dir, name: PRISMICRC })\n\t\t: rc9.writeUser(validatedConfig, PRISMICRC);\n};\n\nexport const updatePrismicrc = (config: Prismicrc, dir?: string): Prismicrc => {\n\tconst { value: validatedConfig, error } = decode(Prismicrc, config);\n\n\tif (error) {\n\t\tthrow new Error(`Failed to validate config: ${error.errors.join(\", \")}`);\n\t}\n\n\treturn dir\n\t\t? rc9.update(validatedConfig, { dir, name: PRISMICRC })\n\t\t: rc9.updateUser(validatedConfig, PRISMICRC);\n};\n"],"names":[],"mappings":";;;;AAMA,MAAM,YAAY;AAElB,MAAM,YAAY,EAAE,QAAQ;AAAA,EAC3B,WAAW,EAAE;AACb,CAAA;AAGY,MAAA,mBAAmB,CAAC,QAA2B;AAC3D,QAAM,eAAe,MAClB,IAAI,KAAK,EAAE,KAAK,MAAM,UAAW,CAAA,IACjC,IAAI,SAAS,SAAS;AAEzB,QAAM,EAAE,OAAO,WAAW,MAAU,IAAA,OAAO,WAAW,YAAY;AAElE,MAAI,OAAO;AACV,UAAM,IAAI,MACT,mBACC,MAAM,KAAK,QAAQ,KAAK,SAAS,IAAI,KAAK,gBACtC,MAAM,OAAO,KAAK,IAAI,GAAG;AAAA,EAE/B;AAEM,SAAA;AACR;AAEa,MAAA,gBAAgB,CAAC,QAA0B;AACvD,QAAM,gBAAgB;AAChB,QAAA,mBAAmB,iBAAiB,GAAG;AAEtC,SAAA;AAAA,IACN,GAAG;AAAA,IACH,GAAG;AAAA,EAAA;AAEL;"}