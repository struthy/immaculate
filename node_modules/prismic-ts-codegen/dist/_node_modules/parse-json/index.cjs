"use strict";
const _commonjsHelpers = require("../../_virtual/_commonjsHelpers.cjs");
const index = require("../error-ex/index.cjs");
const index$1 = require("../json-parse-even-better-errors/index.cjs");
require("../lines-and-columns/build/index.cjs");
require("../@babel/code-frame/lib/index.cjs");
const index$2 = require("../../_virtual/index4.cjs");
const index$3 = require("../../_virtual/index5.cjs");
const errorEx = index.errorEx_1;
const fallback = index$1.jsonParseEvenBetterErrors;
const { default: LinesAndColumns } = index$2.__exports;
const { codeFrameColumns } = index$3.__exports;
const JSONError = errorEx("JSONError", {
  fileName: errorEx.append("in %s"),
  codeFrame: errorEx.append("\n\n%s\n")
});
const parseJson = (string, reviver, filename) => {
  if (typeof reviver === "string") {
    filename = reviver;
    reviver = null;
  }
  try {
    try {
      return JSON.parse(string, reviver);
    } catch (error) {
      fallback(string, reviver);
      throw error;
    }
  } catch (error) {
    error.message = error.message.replace(/\n/g, "");
    const indexMatch = error.message.match(/in JSON at position (\d+) while parsing/);
    const jsonError = new JSONError(error);
    if (filename) {
      jsonError.fileName = filename;
    }
    if (indexMatch && indexMatch.length > 0) {
      const lines = new LinesAndColumns(string);
      const index2 = Number(indexMatch[1]);
      const location = lines.locationForIndex(index2);
      const codeFrame = codeFrameColumns(
        string,
        { start: { line: location.line + 1, column: location.column + 1 } },
        { highlightCode: true }
      );
      jsonError.codeFrame = codeFrame;
    }
    throw jsonError;
  }
};
parseJson.JSONError = JSONError;
var parseJson_1 = parseJson;
const parseJson$1 = /* @__PURE__ */ _commonjsHelpers.getDefaultExportFromCjs(parseJson_1);
module.exports = parseJson$1;
//# sourceMappingURL=index.cjs.map
