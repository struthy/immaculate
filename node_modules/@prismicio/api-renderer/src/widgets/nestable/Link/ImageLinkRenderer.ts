import type { ImageLinkContent } from "@prismicio/types-internal/lib/content"

import type { RenderContext } from "../../../models"
import type { AnyLinkDef, LinkRenderer, MediaLinkDef } from "../../../models"

const ImageLinkRenderer: (ctx: RenderContext) => LinkRenderer<MediaLinkDef, ImageLinkContent> = (ctx) => ({
	renderV1(link: ImageLinkContent): unknown {
		return {
			type: "Link.image",
			value: {
				image: {
					name: link.name,
					kind: link.kind,
					url: ctx.urlRewriter.optimizeImageUrl(link.url),
					size: link.size,
					height: link.height,
					width: link.width,
				},
			},
		}
	},

	renderV2(_def: MediaLinkDef | AnyLinkDef, link: ImageLinkContent): unknown {
		return {
			id: link.id,
			link_type: "Media",
			name: link.name,
			kind: link.kind,
			url: ctx.urlRewriter.optimizeImageUrl(link.url),
			size: link.size,
			height: link.height,
			width: link.width,
		}
	},

	renderMocks(_def: MediaLinkDef | AnyLinkDef, _link: ImageLinkContent): unknown {
		return {
			link_type: "Media",
			name: "mock",
			kind: "image",
			url: "https://source.unsplash.com/random",
			size: "10kB",
			height: "1920px",
			width: "1080px",
		}
	},
})

export default ImageLinkRenderer
