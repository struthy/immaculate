{"version":3,"file":"inboundfilters.cjs","sources":["../../../../../../../../../../../node_modules/@sentry/node/node_modules/@sentry/core/esm/integrations/inboundfilters.js"],"sourcesContent":["import { logger, getEventDescription, stringMatchesSomePattern } from '@sentry/utils';\nimport { DEBUG_BUILD } from '../debug-build.js';\nimport { convertIntegrationFnToClass, defineIntegration } from '../integration.js';\n\n// \"Script error.\" is hard coded into browsers for errors that it can't read.\n// this is the result of a script being pulled in from an external domain and CORS.\nconst DEFAULT_IGNORE_ERRORS = [\n  /^Script error\\.?$/,\n  /^Javascript error: Script error\\.? on line 0$/,\n  /^ResizeObserver loop completed with undelivered notifications.$/,\n  /^Cannot redefine property: googletag$/,\n];\n\nconst DEFAULT_IGNORE_TRANSACTIONS = [\n  /^.*\\/healthcheck$/,\n  /^.*\\/healthy$/,\n  /^.*\\/live$/,\n  /^.*\\/ready$/,\n  /^.*\\/heartbeat$/,\n  /^.*\\/health$/,\n  /^.*\\/healthz$/,\n];\n\n/** Options for the InboundFilters integration */\n\nconst INTEGRATION_NAME = 'InboundFilters';\nconst _inboundFiltersIntegration = ((options = {}) => {\n  return {\n    name: INTEGRATION_NAME,\n    // TODO v8: Remove this\n    setupOnce() {}, // eslint-disable-line @typescript-eslint/no-empty-function\n    processEvent(event, _hint, client) {\n      const clientOptions = client.getOptions();\n      const mergedOptions = _mergeOptions(options, clientOptions);\n      return _shouldDropEvent(event, mergedOptions) ? null : event;\n    },\n  };\n}) ;\n\nconst inboundFiltersIntegration = defineIntegration(_inboundFiltersIntegration);\n\n/**\n * Inbound filters configurable by the user.\n * @deprecated Use `inboundFiltersIntegration()` instead.\n */\n// eslint-disable-next-line deprecation/deprecation\nconst InboundFilters = convertIntegrationFnToClass(\n  INTEGRATION_NAME,\n  inboundFiltersIntegration,\n)\n\n;\n\nfunction _mergeOptions(\n  internalOptions = {},\n  clientOptions = {},\n) {\n  return {\n    allowUrls: [...(internalOptions.allowUrls || []), ...(clientOptions.allowUrls || [])],\n    denyUrls: [...(internalOptions.denyUrls || []), ...(clientOptions.denyUrls || [])],\n    ignoreErrors: [\n      ...(internalOptions.ignoreErrors || []),\n      ...(clientOptions.ignoreErrors || []),\n      ...(internalOptions.disableErrorDefaults ? [] : DEFAULT_IGNORE_ERRORS),\n    ],\n    ignoreTransactions: [\n      ...(internalOptions.ignoreTransactions || []),\n      ...(clientOptions.ignoreTransactions || []),\n      ...(internalOptions.disableTransactionDefaults ? [] : DEFAULT_IGNORE_TRANSACTIONS),\n    ],\n    ignoreInternal: internalOptions.ignoreInternal !== undefined ? internalOptions.ignoreInternal : true,\n  };\n}\n\nfunction _shouldDropEvent(event, options) {\n  if (options.ignoreInternal && _isSentryError(event)) {\n    DEBUG_BUILD &&\n      logger.warn(`Event dropped due to being internal Sentry Error.\\nEvent: ${getEventDescription(event)}`);\n    return true;\n  }\n  if (_isIgnoredError(event, options.ignoreErrors)) {\n    DEBUG_BUILD &&\n      logger.warn(\n        `Event dropped due to being matched by \\`ignoreErrors\\` option.\\nEvent: ${getEventDescription(event)}`,\n      );\n    return true;\n  }\n  if (_isIgnoredTransaction(event, options.ignoreTransactions)) {\n    DEBUG_BUILD &&\n      logger.warn(\n        `Event dropped due to being matched by \\`ignoreTransactions\\` option.\\nEvent: ${getEventDescription(event)}`,\n      );\n    return true;\n  }\n  if (_isDeniedUrl(event, options.denyUrls)) {\n    DEBUG_BUILD &&\n      logger.warn(\n        `Event dropped due to being matched by \\`denyUrls\\` option.\\nEvent: ${getEventDescription(\n          event,\n        )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n      );\n    return true;\n  }\n  if (!_isAllowedUrl(event, options.allowUrls)) {\n    DEBUG_BUILD &&\n      logger.warn(\n        `Event dropped due to not being matched by \\`allowUrls\\` option.\\nEvent: ${getEventDescription(\n          event,\n        )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n      );\n    return true;\n  }\n  return false;\n}\n\nfunction _isIgnoredError(event, ignoreErrors) {\n  // If event.type, this is not an error\n  if (event.type || !ignoreErrors || !ignoreErrors.length) {\n    return false;\n  }\n\n  return _getPossibleEventMessages(event).some(message => stringMatchesSomePattern(message, ignoreErrors));\n}\n\nfunction _isIgnoredTransaction(event, ignoreTransactions) {\n  if (event.type !== 'transaction' || !ignoreTransactions || !ignoreTransactions.length) {\n    return false;\n  }\n\n  const name = event.transaction;\n  return name ? stringMatchesSomePattern(name, ignoreTransactions) : false;\n}\n\nfunction _isDeniedUrl(event, denyUrls) {\n  // TODO: Use Glob instead?\n  if (!denyUrls || !denyUrls.length) {\n    return false;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? false : stringMatchesSomePattern(url, denyUrls);\n}\n\nfunction _isAllowedUrl(event, allowUrls) {\n  // TODO: Use Glob instead?\n  if (!allowUrls || !allowUrls.length) {\n    return true;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? true : stringMatchesSomePattern(url, allowUrls);\n}\n\nfunction _getPossibleEventMessages(event) {\n  const possibleMessages = [];\n\n  if (event.message) {\n    possibleMessages.push(event.message);\n  }\n\n  let lastException;\n  try {\n    // @ts-expect-error Try catching to save bundle size\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    lastException = event.exception.values[event.exception.values.length - 1];\n  } catch (e) {\n    // try catching to save bundle size checking existence of variables\n  }\n\n  if (lastException) {\n    if (lastException.value) {\n      possibleMessages.push(lastException.value);\n      if (lastException.type) {\n        possibleMessages.push(`${lastException.type}: ${lastException.value}`);\n      }\n    }\n  }\n\n  if (DEBUG_BUILD && possibleMessages.length === 0) {\n    logger.error(`Could not extract message for event ${getEventDescription(event)}`);\n  }\n\n  return possibleMessages;\n}\n\nfunction _isSentryError(event) {\n  try {\n    // @ts-expect-error can't be a sentry error if undefined\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    return event.exception.values[0].type === 'SentryError';\n  } catch (e) {\n    // ignore\n  }\n  return false;\n}\n\nfunction _getLastValidUrl(frames = []) {\n  for (let i = frames.length - 1; i >= 0; i--) {\n    const frame = frames[i];\n\n    if (frame && frame.filename !== '<anonymous>' && frame.filename !== '[native code]') {\n      return frame.filename || null;\n    }\n  }\n\n  return null;\n}\n\nfunction _getEventFilterUrl(event) {\n  try {\n    let frames;\n    try {\n      // @ts-expect-error we only care about frames if the whole thing here is defined\n      frames = event.exception.values[0].stacktrace.frames;\n    } catch (e) {\n      // ignore\n    }\n    return frames ? _getLastValidUrl(frames) : null;\n  } catch (oO) {\n    DEBUG_BUILD && logger.error(`Cannot extract url for event ${getEventDescription(event)}`);\n    return null;\n  }\n}\n\nexport { InboundFilters, inboundFiltersIntegration };\n//# sourceMappingURL=inboundfilters.js.map\n"],"names":["defineIntegration","convertIntegrationFnToClass","DEBUG_BUILD","logger","getEventDescription","stringMatchesSomePattern"],"mappings":"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","x_google_ignoreList":[0]}