{"version":3,"file":"domain.cjs","sources":["../../../../../../../../node_modules/@sentry/node/esm/async/domain.js"],"sourcesContent":["import { _optionalChain } from '@sentry/utils';\nimport * as domain from 'domain';\nimport { setAsyncContextStrategy, ensureHubOnCarrier, getHubFromCarrier, setHubOnCarrier } from '@sentry/core';\n\nfunction getActiveDomain() {\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n  return (domain ).active ;\n}\n\n// eslint-disable-next-line deprecation/deprecation\nfunction getCurrentHub() {\n  const activeDomain = getActiveDomain();\n\n  // If there's no active domain, just return undefined and the global hub will be used\n  if (!activeDomain) {\n    return undefined;\n  }\n\n  ensureHubOnCarrier(activeDomain);\n\n  return getHubFromCarrier(activeDomain);\n}\n\n// eslint-disable-next-line deprecation/deprecation\nfunction createNewHub(parent) {\n  const carrier = {};\n  ensureHubOnCarrier(carrier, parent);\n  return getHubFromCarrier(carrier);\n}\n\nfunction runWithAsyncContext(callback, options) {\n  const activeDomain = getActiveDomain();\n\n  if (activeDomain && _optionalChain([options, 'optionalAccess', _ => _.reuseExisting])) {\n    // We're already in a domain, so we don't need to create a new one, just call the callback with the current hub\n    return callback();\n  }\n\n  const local = domain.create() ;\n\n  const parentHub = activeDomain ? getHubFromCarrier(activeDomain) : undefined;\n  const newHub = createNewHub(parentHub);\n  setHubOnCarrier(local, newHub);\n\n  return local.bind(() => {\n    return callback();\n  })();\n}\n\n/**\n * Sets the async context strategy to use Node.js domains.\n */\nfunction setDomainAsyncContextStrategy() {\n  setAsyncContextStrategy({ getCurrentHub, runWithAsyncContext });\n}\n\nexport { setDomainAsyncContextStrategy };\n//# sourceMappingURL=domain.js.map\n"],"names":["domain","ensureHubOnCarrier","getHubFromCarrier","_optionalChain","setHubOnCarrier","setAsyncContextStrategy"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAIA,SAAS,kBAAkB;AAEzB,SAAQA,kBAAS;AACnB;AAGA,SAAS,gBAAgB;AACvB,QAAM,eAAe;AAGrB,MAAI,CAAC,cAAc;AACjB,WAAO;AAAA,EACR;AAEDC,MAAkB,mBAAC,YAAY;AAE/B,SAAOC,IAAAA,kBAAkB,YAAY;AACvC;AAGA,SAAS,aAAa,QAAQ;AAC5B,QAAM,UAAU,CAAA;AAChBD,yBAAmB,SAAS,MAAM;AAClC,SAAOC,IAAAA,kBAAkB,OAAO;AAClC;AAEA,SAAS,oBAAoB,UAAU,SAAS;AAC9C,QAAM,eAAe;AAErB,MAAI,gBAAgBC,eAAc,eAAC,CAAC,SAAS,kBAAkB,OAAK,EAAE,aAAa,CAAC,GAAG;AAErF,WAAO,SAAQ;AAAA,EAChB;AAED,QAAM,QAAQH,kBAAO;AAErB,QAAM,YAAY,eAAeE,IAAiB,kBAAC,YAAY,IAAI;AACnE,QAAM,SAAS,aAAa,SAAS;AACrCE,sBAAgB,OAAO,MAAM;AAE7B,SAAO,MAAM,KAAK,MAAM;AACtB,WAAO,SAAQ;AAAA,EAChB,CAAA;AACH;AAKA,SAAS,gCAAgC;AACvCC,MAAAA,wBAAwB,EAAE,eAAe,oBAAmB,CAAE;AAChE;;","x_google_ignoreList":[0]}