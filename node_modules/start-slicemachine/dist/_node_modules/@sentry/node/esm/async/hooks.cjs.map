{"version":3,"file":"hooks.cjs","sources":["../../../../../../../../node_modules/@sentry/node/esm/async/hooks.js"],"sourcesContent":["import { _optionalChain } from '@sentry/utils';\nimport { setAsyncContextStrategy, ensureHubOnCarrier, getHubFromCarrier } from '@sentry/core';\nimport * as async_hooks from 'async_hooks';\n\n// eslint-disable-next-line deprecation/deprecation\nlet asyncStorage;\n\n/**\n * Sets the async context strategy to use AsyncLocalStorage which requires Node v12.17.0 or v13.10.0.\n */\nfunction setHooksAsyncContextStrategy() {\n  if (!asyncStorage) {\n    // eslint-disable-next-line deprecation/deprecation\n    asyncStorage = new (async_hooks ).AsyncLocalStorage();\n  }\n\n  // eslint-disable-next-line deprecation/deprecation\n  function getCurrentHub() {\n    return asyncStorage.getStore();\n  }\n\n  // eslint-disable-next-line deprecation/deprecation\n  function createNewHub(parent) {\n    const carrier = {};\n    ensureHubOnCarrier(carrier, parent);\n    return getHubFromCarrier(carrier);\n  }\n\n  function runWithAsyncContext(callback, options) {\n    const existingHub = getCurrentHub();\n\n    if (existingHub && _optionalChain([options, 'optionalAccess', _ => _.reuseExisting])) {\n      // We're already in an async context, so we don't need to create a new one\n      // just call the callback with the current hub\n      return callback();\n    }\n\n    const newHub = createNewHub(existingHub);\n\n    return asyncStorage.run(newHub, () => {\n      return callback();\n    });\n  }\n\n  setAsyncContextStrategy({ getCurrentHub, runWithAsyncContext });\n}\n\nexport { setHooksAsyncContextStrategy };\n//# sourceMappingURL=hooks.js.map\n"],"names":["async_hooks","ensureHubOnCarrier","getHubFromCarrier","_optionalChain","setAsyncContextStrategy"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAKA,IAAI;AAKJ,SAAS,+BAA+B;AACtC,MAAI,CAAC,cAAc;AAEjB,mBAAe,IAAKA,uBAAc;EACnC;AAGD,WAAS,gBAAgB;AACvB,WAAO,aAAa;EACrB;AAGD,WAAS,aAAa,QAAQ;AAC5B,UAAM,UAAU,CAAA;AAChBC,2BAAmB,SAAS,MAAM;AAClC,WAAOC,IAAAA,kBAAkB,OAAO;AAAA,EACjC;AAED,WAAS,oBAAoB,UAAU,SAAS;AAC9C,UAAM,cAAc;AAEpB,QAAI,eAAeC,eAAc,eAAC,CAAC,SAAS,kBAAkB,OAAK,EAAE,aAAa,CAAC,GAAG;AAGpF,aAAO,SAAQ;AAAA,IAChB;AAED,UAAM,SAAS,aAAa,WAAW;AAEvC,WAAO,aAAa,IAAI,QAAQ,MAAM;AACpC,aAAO,SAAQ;AAAA,IACrB,CAAK;AAAA,EACF;AAEDC,MAAAA,wBAAwB,EAAE,eAAe,oBAAmB,CAAE;AAChE;;","x_google_ignoreList":[0]}