import { getEnvironmentInfo } from "@slicemachine/manager";
import { SENTRY_EXPRESS_DSN } from "../constants.js";
import { checkIsSentryEnabled } from "./checkIsSentryEnabled.js";
import { init } from './../_node_modules/@sentry/node/esm/sdk.js';
import { setUser, setTag, setContext } from './../_node_modules/@sentry/node/_node_modules/@sentry/core/esm/exports.js';
const setupSentry = async (manager) => {
  if (!checkIsSentryEnabled()) {
    return;
  }
  const sliceMachineVersion = await manager.versions.getRunningSliceMachineVersion();
  const sliceMachineConfig = await manager.project.getSliceMachineConfig();
  let userProfile;
  try {
    userProfile = await manager.user.getProfile();
  } catch {
  }
  const { environment, release } = getEnvironmentInfo({
    name: "slice-machine-ui",
    version: sliceMachineVersion
  });
  init({
    dsn: SENTRY_EXPRESS_DSN,
    release,
    environment,
    // Increase the default truncation length of 250 to 2500 (x10)
    // to have enough details in Sentry
    maxValueLength: 2500
  });
  if (userProfile) {
    setUser({ id: userProfile.shortId });
  }
  setTag("repository", sliceMachineConfig.repositoryName);
  setContext("Repository Data", {
    name: sliceMachineConfig.repositoryName
  });
};
export {
  setupSentry
};
//# sourceMappingURL=setupSentry.js.map
