{"version":3,"file":"setupSentry.js","sources":["../../../src/lib/setupSentry.ts"],"sourcesContent":["import * as Sentry from \"@sentry/node\";\nimport {\n\tPrismicUserProfile,\n\tSliceMachineManager,\n\tgetEnvironmentInfo,\n} from \"@slicemachine/manager\";\n\nimport { SENTRY_EXPRESS_DSN } from \"../constants\";\nimport { checkIsSentryEnabled } from \"./checkIsSentryEnabled\";\n\nexport const setupSentry = async (\n\tmanager: SliceMachineManager,\n): Promise<void> => {\n\tif (!checkIsSentryEnabled()) {\n\t\treturn;\n\t}\n\n\tconst sliceMachineVersion =\n\t\tawait manager.versions.getRunningSliceMachineVersion();\n\n\tconst sliceMachineConfig = await manager.project.getSliceMachineConfig();\n\n\tlet userProfile: PrismicUserProfile | undefined;\n\ttry {\n\t\tuserProfile = await manager.user.getProfile();\n\t} catch {\n\t\t// User is not logged in, it doesn't matter\n\t}\n\n\tconst { environment, release } = getEnvironmentInfo({\n\t\tname: \"slice-machine-ui\",\n\t\tversion: sliceMachineVersion,\n\t});\n\n\tSentry.init({\n\t\tdsn: SENTRY_EXPRESS_DSN,\n\t\trelease,\n\t\tenvironment,\n\t\t// Increase the default truncation length of 250 to 2500 (x10)\n\t\t// to have enough details in Sentry\n\t\tmaxValueLength: 2_500,\n\t});\n\tif (userProfile) {\n\t\tSentry.setUser({ id: userProfile.shortId });\n\t}\n\tSentry.setTag(\"repository\", sliceMachineConfig.repositoryName);\n\tSentry.setContext(\"Repository Data\", {\n\t\tname: sliceMachineConfig.repositoryName,\n\t});\n};\n"],"names":["Sentry.init","Sentry.setUser","Sentry.setTag","Sentry.setContext"],"mappings":";;;;;AAUa,MAAA,cAAc,OAC1B,YACkB;AACd,MAAA,CAAC,wBAAwB;AAC5B;AAAA,EACA;AAED,QAAM,sBACL,MAAM,QAAQ,SAAS,8BAA6B;AAErD,QAAM,qBAAqB,MAAM,QAAQ,QAAQ,sBAAqB;AAElE,MAAA;AACA,MAAA;AACW,kBAAA,MAAM,QAAQ,KAAK;UAChC;AAAA,EAED;AAED,QAAM,EAAE,aAAa,QAAS,IAAG,mBAAmB;AAAA,IACnD,MAAM;AAAA,IACN,SAAS;AAAA,EAAA,CACT;AAEDA,OAAY;AAAA,IACX,KAAK;AAAA,IACL;AAAA,IACA;AAAA;AAAA;AAAA,IAGA,gBAAgB;AAAA,EAAA,CAChB;AACD,MAAI,aAAa;AAChBC,YAAe,EAAE,IAAI,YAAY,QAAS,CAAA;AAAA,EAC1C;AACMC,SAAO,cAAc,mBAAmB,cAAc;AAC7DC,aAAkB,mBAAmB;AAAA,IACpC,MAAM,mBAAmB;AAAA,EAAA,CACzB;AACF;"}